<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEEP DIVE MEETING PROGRESS UPDATE - EAST</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom Font Import if needed, using system fonts for speed */
        body { font-family: 'Inter', sans-serif; }
        .bg-undp-blue { background-color: #006EB5; }
        .text-undp-blue { color: #006EB5; }
        .bg-undp-light { background-color: #41B6E6; }
        .text-undp-light { color: #41B6E6; }
        .border-undp-blue { border-color: #006EB5; }
        
        /* Smooth transitions for bars */
        .progress-bar { transition: width 1s ease-out; }
    </style>
</head>
<body class="min-h-screen bg-[#020b1c] text-slate-200 selection:bg-[#006EB5]/30">

    <!-- Decorative Background -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-[#006EB5]/10 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-[#41B6E6]/10 rounded-full blur-[120px]"></div>
    </div>

    <div class="relative z-10 max-w-7xl mx-auto px-6 py-10">
        
        <!-- Header -->
        <header class="mb-12 flex flex-col md:flex-row md:items-start justify-between gap-6 border-b border-[#003366] pb-8 relative overflow-hidden">
            
            <div class="relative z-10 pt-4">
                <div class="flex items-center gap-2 mb-4">
                    <!-- Added ID for dynamic date update -->
                    <span id="last-updated-date" class="text-slate-400 text-xs font-semibold uppercase tracking-wider">Updated Dec 2025</span>
                </div>
                
                <!-- Project Title (Regular Font) -->
                <div class="text-xl md:text-2xl font-normal text-white mb-2">
                    UNDP Local Peacebuilding and Resilience Project
                </div>

                <!-- Dashboard Title (Bold/Large Font) -->
                <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight leading-tight">
                    <span class="text-[#006EB5]">East Region Activities Dashboard</span><br>
                    Deep Dive Meeting
                </h1>
            </div>

            <!-- Right Side cleared as requested -->
            
        </header>

        <!-- Key Metrics Title -->
        <h2 class="text-xl font-semibold text-white flex items-center gap-2 mb-6">
            <div class="w-1.5 h-6 bg-[#006EB5] rounded-full"></div>
            <span>Activities Overview</span>
        </h2>

        <!-- Key Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-12" id="stats-grid">
            <!-- Stats injected by JS -->
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
            
            <!-- Status Distribution -->
            <div class="bg-[#002347]/40 border border-[#006EB5]/20 p-6 rounded-2xl backdrop-blur-md flex flex-col items-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#006EB5] to-[#41B6E6]"></div>
                <h3 class="text-slate-200 font-semibold mb-6 flex items-center gap-2 w-full">
                    <i data-lucide="pie-chart" class="w-4 h-4 text-[#41B6E6]"></i> Status Distribution
                </h3>
                <div class="flex items-center justify-between w-full px-4" id="status-chart-container">
                    <!-- Donut Chart -->
                </div>
            </div>

            <!-- Donor Allocation -->
            <div class="lg:col-span-2 bg-[#002347]/40 border border-[#006EB5]/20 p-6 rounded-2xl backdrop-blur-md flex flex-col relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#006EB5] to-[#41B6E6]"></div>
                <h3 class="text-slate-200 font-semibold mb-6 flex items-center gap-2">
                    <i data-lucide="activity" class="w-4 h-4 text-[#41B6E6]"></i> Donors 
                </h3>
                <div class="flex flex-col md:flex-row items-center justify-center h-full gap-8 md:gap-16">
                    <div class="shrink-0" id="donor-chart-container">
                        <!-- Donut Chart -->
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-12 gap-y-6 w-full max-w-md" id="donor-legend">
                        <!-- Legend Items -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="space-y-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <h2 class="text-xl font-semibold text-white flex items-center gap-2">
                    <div class="w-1.5 h-6 bg-[#006EB5] rounded-full"></div>
                    <!-- Updated Title to "Activities Cards" -->
                    <span id="projects-title">Activities Cards</span>
                </h2>
                <div class="flex gap-2">
                    <button onclick="setFilter('all')" id="btn-all" class="px-4 py-1.5 rounded-lg text-sm font-medium transition-colors bg-[#006EB5] text-white shadow-lg shadow-[#006EB5]/20">
                        All Projects
                    </button>
                    <button onclick="setFilter('delayed')" id="btn-delayed" class="px-4 py-1.5 rounded-lg text-sm font-medium transition-colors bg-[#002347] text-slate-400 border border-[#003366] hover:bg-[#003366]">
                        Delayed / Attention
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid">
                <!-- Project Cards injected by JS -->
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-16 pt-8 border-t border-[#003366] flex flex-col md:flex-row justify-between items-center text-slate-500 text-sm gap-4">
            <div class="flex gap-6">
                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-[#41B6E6]"></div><span>On Track</span></div>
                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-amber-400"></div><span>Attention Required</span></div>
                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-rose-500"></div><span>Action Item</span></div>
            </div>
            <p>Â© 2025 United Nations Development Programme. Internal Use Only.</p>
        </div>

    </div>

    <!-- Application Logic -->
    <script>
        // --- Data ---
        // Populated with correct East Region Projects from PDF
        const projects = [
            {
                id: 1, 
                region: "East", 
                donor: "France", 
                activity: "Weather Station Equipment",
                percentage: 100, 
                progressDesc: "Transport of equipment to target locations under preparation", 
                comments: "Discussion on installation still ongoing with LNMC",
                icon: "cloud-rain",
                link: "https://drive.google.com/drive/folders/1AevU9U_AfhpfpZvNza55fMDvRU_pn879?usp=sharing",
                value: "74,957.70"
            },
            {
                id: 2, 
                region: "East", 
                donor: "EU", 
                activity: "Silphium Square Rehabilitation Project",
                percentage: 100, 
                progressDesc: "Completed", 
                status: "Finalized",
                comments: "Completion date 15 Dec 2025. On schedule.",
                icon: "map",
                value: "134,255",
                link: "https://drive.google.com/drive/folders/1ckIfJ9ss_wMHsolRxYXsRU-Hq3xktizK?usp=sharing"
            },
            {
                id: 3, 
                region: "East", 
                donor: "EU", 
                activity: "Engineering Consultancy: Al-Rabih Market Reconstruction",
                percentage: 100, 
                progressDesc: "under final handover Process", 
                comments: "Completion date 21st Jan 2026.",
                icon: "store",
                value: "124,400",
                link: "https://drive.google.com/drive/folders/13P1Z8Jg6WFpY-2ua5qHdl0H3DCamcCXO?usp=sharing"
            },
            {
                id: 4, 
                region: "East", 
                donor: "Libya", 
                activity: "Benghazi Municipal Building Rehabilitation",
                percentage: 60, 
                progressDesc: "Ongoing", 
                comments: "Completion date 30th June 2026.",
                icon: "building-2",
                value: "2,150,000"
            },
            {
                id: 5, 
                region: "East", 
                donor: "Libya", 
                activity: "Rehabilitation of Historical Building Al Manar Palace",
                percentage: 100, 
                progressDesc: "Pending Retention", 
                status: "Finalized", // Marking finalized based on 100% work
                comments: "Work completed 30 March 2025. Currently in retention period.",
                icon: "landmark",
                value: "2,189,438",
                link: "https://drive.google.com/drive/folders/1jFwiEv5-bzKpuf0B29cCpgkDWLfAxU46?usp=sharing"
            },
            {
                id: 6, 
                region: "East", 
                donor: "France", 
                activity: "Rehabilitation of five water pump stations (Bayda)",
                percentage: 100, 
                progressDesc: "Under final handover process", 
                comments: "Completion date 26th Dec 2025.",
                icon: "droplets",
                value: "294,895",
                link: "https://drive.google.com/drive/folders/1CcEBGQumO-6r1jnHFPUd8U6Oj5ZBeoOe?usp=sharing"
            },
            {
                id: 7, 
                region: "East", 
                donor: "AfDB", 
                activity: "TOT Training: Municipal Business Incubators (DERAYA)",
                percentage: 100, 
                progressDesc: "Finalized", 
                status: "Finalized", 
                comments: "Benghazi completed 4/11/2025, Derna completed 12/11/2025.",
                icon: "graduation-cap",
                link: "https://www.facebook.com/story.php?story_fbid=760487450380587&id=100092580150883&mibextid=wwXIfr&rdid=Hq4VhKRL8JBxmKqH",
                value: "15,000"
            },
            {
                id: 8, 
                region: "East", 
                donor: "AfDB", 
                activity: "Small Grants to Startups in Benghazi and Derna",
                percentage: 55, 
                progressDesc: "Ongoing", 
                comments: "Completion date 30 May 2026.",
                icon: "coins",
                value: "190,456.240"
            }
        ];

        // --- Helpers ---
        function createDonutChart(data, size = 160, thickness = 12, overrideValue = null, label = "Total") {
            const total = data.reduce((acc, item) => acc + item.value, 0);
            const displayValue = overrideValue !== null ? overrideValue : total;
            
            const radius = (size - thickness) / 2;
            const circumference = 2 * Math.PI * radius;
            let currentOffset = 0;

            let svgContent = data.map((item) => {
                const strokeDasharray = `${(item.value / total) * circumference} ${circumference}`;
                const strokeDashoffset = -currentOffset;
                currentOffset += (item.value / total) * circumference;

                return `<circle cx="${size/2}" cy="${size/2}" r="${radius}" fill="transparent" stroke="${item.color}" stroke-width="${thickness}" stroke-dasharray="${strokeDasharray}" stroke-dashoffset="${strokeDashoffset}" stroke-linecap="round" class="hover:opacity-80 transition-opacity duration-300" />`;
            }).join('');

            return `
                <div class="relative flex items-center justify-center" style="width: ${size}px; height: ${size}px;">
                    <svg width="${size}" height="${size}" class="transform -rotate-90">
                        ${svgContent}
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span class="text-3xl font-bold text-white">${displayValue}</span>
                        <span class="text-[10px] uppercase tracking-widest text-[#41B6E6]">${label}</span>
                    </div>
                </div>
            `;
        }

        function createProjectCard(project) {
            const commentsLower = project.comments?.toLowerCase() || "";
            const progressLower = project.progressDesc?.toLowerCase() || "";
            
            const isDelayed = commentsLower.includes('delay') || commentsLower.includes('stalled') || commentsLower.includes('awaiting') || progressLower.includes('stalled');
            const isActionRequired = commentsLower.includes("action required") || commentsLower.includes("follow up");
            
            // Status Badge
            let statusBadge = '';
            if (project.status === 'Finalized' || project.percentage === 100) {
                 statusBadge = `<span class="flex items-center gap-1 text-emerald-400 text-xs font-bold bg-emerald-500/10 px-2 py-1 rounded-full border border-emerald-500/20"><i data-lucide="check-circle-2" class="w-3 h-3"></i> Finalized</span>`;
            } else if (project.status === 'Stalled') {
                 statusBadge = `<span class="flex items-center gap-1 text-rose-400 text-xs font-bold bg-rose-500/10 px-2 py-1 rounded-full border border-rose-500/20"><i data-lucide="x-circle" class="w-3 h-3"></i> Stalled</span>`;
            } else {
                 statusBadge = `<span class="flex items-center gap-1 text-[#41B6E6] text-xs font-bold bg-[#006EB5]/10 px-2 py-1 rounded-full border border-[#006EB5]/20"><i data-lucide="clock" class="w-3 h-3"></i> Active</span>`;
            }

            // Footer Logic
            let footerContent = '';
            if (isActionRequired) {
                footerContent = `
                    <div class="flex items-start gap-2 text-xs text-rose-300 bg-rose-900/10 p-2 rounded border border-rose-500/20">
                        <i data-lucide="alert-circle" class="w-3.5 h-3.5 shrink-0 mt-0.5"></i>
                        <span class="font-semibold">${project.comments}</span>
                    </div>`;
            } else if (isDelayed) {
                footerContent = `
                    <div class="flex items-start gap-2 text-xs text-amber-300 bg-amber-900/10 p-2 rounded border border-amber-500/20">
                        <i data-lucide="alert-triangle" class="w-3.5 h-3.5 shrink-0 mt-0.5"></i>
                        <span>${project.comments}</span>
                    </div>`;
            } else {
                footerContent = `
                    <div class="flex items-start gap-2 text-xs text-slate-400">
                        <i data-lucide="message-square" class="w-3.5 h-3.5 shrink-0 mt-0.5 text-[#006EB5]"></i>
                        <span>${project.comments || "No comments."}</span>
                    </div>`;
            }
            
            // Link Logic
            let linkContent = '';
            if (project.link) {
                linkContent = `
                    <a href="${project.link}" target="_blank" class="mt-3 flex items-center gap-1.5 text-xs font-bold text-[#41B6E6] hover:text-white transition-colors group/link w-fit">
                        View Resource <i data-lucide="arrow-up-right" class="w-3.5 h-3.5 transition-transform group-hover/link:-translate-y-0.5 group-hover/link:translate-x-0.5"></i>
                    </a>
                `;
            }

            // Value Logic (Aligned & Single Line)
            let valueContent = '';
            let valueText = project.value;
            // Add USD prefix if missing and it looks like a number
            if (valueText && !valueText.toString().includes('USD')) {
                 valueText = 'USD ' + valueText;
            }

            if (valueText) {
                 valueContent = `
                    <div class="mb-4 relative bg-[#001a33] border border-[#003366] rounded-xl px-4 py-3 overflow-hidden group-hover:border-[#006EB5]/50 transition-colors flex items-center gap-3">
                        <div class="p-1.5 rounded-lg bg-[#006EB5]/20 text-[#41B6E6] border border-[#006EB5]/30 shrink-0">
                            <i data-lucide="dollar-sign" class="w-4 h-4"></i>
                        </div>
                        <div class="flex items-baseline gap-2">
                            <span class="text-xs uppercase tracking-widest text-slate-400 font-semibold">Value:</span>
                            <span class="text-lg font-bold text-white tracking-tight">${valueText}</span>
                        </div>
                    </div>
                 `;
            }

            // Progress Bar Logic
            let barColorClass = 'from-[#006EB5] to-[#41B6E6]';
            let textColorClass = 'text-[#41B6E6]';
            let percentageDisplay = project.percentage !== null ? `${project.percentage}%` : 'N/A';
            let barWidth = project.percentage !== null ? project.percentage : 0;
            
            if (project.percentage === 100) {
                barColorClass = 'from-emerald-500 to-emerald-300';
                textColorClass = 'text-emerald-400';
            } else if (project.status === 'Stalled') {
                barColorClass = 'from-rose-500 to-rose-700';
                textColorClass = 'text-rose-400';
            }
            
            let progressSection = '';
            if (project.percentage === null) {
                // If no percentage is known/applicable
                progressSection = `
                 <div>
                    <div class="flex justify-between text-xs mb-1.5">
                        <span class="text-slate-400 font-medium">Status</span>
                        <span class="${textColorClass} font-bold">${project.progressDesc}</span>
                    </div>
                    <div class="h-2 w-full bg-[#001a33] rounded-full overflow-hidden border border-[#003366]/50">
                        <div class="h-full w-full bg-slate-700/30 rounded-full flex items-center justify-center">
                           <div class="w-1/3 h-full bg-slate-600/50 animate-pulse rounded-full"></div>
                        </div>
                    </div>
                 </div>
                `;
            } else {
                progressSection = `
                    <div>
                        <div class="flex justify-between text-xs mb-1.5">
                            <span class="text-slate-400 font-medium">Completion</span>
                            <span class="${textColorClass} font-bold">${percentageDisplay}</span>
                        </div>
                        <div class="h-2 w-full bg-[#001a33] rounded-full overflow-hidden border border-[#003366]/50">
                            <div class="h-full bg-gradient-to-r ${barColorClass} rounded-full" style="width: ${barWidth}%"></div>
                        </div>
                        ${project.percentage < 100 ? `<p class="text-[10px] text-slate-500 mt-2">${project.progressDesc}</p>` : ''}
                    </div>`;
            }

            return `
                <div class="group relative overflow-hidden rounded-2xl bg-[#002347]/60 p-6 border border-[#006EB5]/30 backdrop-blur-xl shadow-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-[#006EB5]/20 hover:border-[#006EB5]/80">
                    <div class="absolute -right-10 -top-10 h-32 w-32 rounded-full bg-[#006EB5]/10 blur-3xl group-hover:bg-[#006EB5]/20 transition-all duration-500"></div>
                    <div class="relative z-10 flex flex-col h-full justify-between">
                        <div>
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2.5 py-1 rounded-md text-xs font-bold bg-[#006EB5]/20 text-[#41B6E6] border border-[#006EB5]/30">${project.donor}</span>
                                    ${project.region ? `<span class="px-2 py-1 rounded-md text-xs font-medium text-slate-300 flex items-center gap-1"><i data-lucide="map-pin" class="w-3 h-3"></i> ${project.region}</span>` : ''}
                                </div>
                                ${statusBadge}
                            </div>
                            <!-- Added min-h to align content across cards -->
                            <div class="flex items-start gap-3 mb-2 min-h-[3.5rem]">
                                <div class="p-2 rounded-lg bg-[#001a33] text-[#006EB5] border border-[#003366] shrink-0 mt-1">
                                    <i data-lucide="${project.icon}" class="w-5 h-5"></i>
                                </div>
                                <h3 class="text-sm md:text-base font-semibold text-white leading-snug">${project.activity}</h3>
                            </div>
                        </div>
                        <div class="mt-6 space-y-4">
                            ${valueContent}
                            ${progressSection}
                            <div class="pt-4 border-t border-[#003366] min-h-[60px]">
                                ${footerContent}
                                ${linkContent}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createStatCard(title, value, subtext, icon, trend) {
            const trendClass = trend === 'up' ? 'from-[#006EB5]/20 to-[#41B6E6]/20 text-[#41B6E6]' : 'from-[#001a33] to-[#002347] text-slate-400';
            return `
                <div class="bg-[#002347]/40 border border-[#006EB5]/20 p-5 rounded-2xl backdrop-blur-md flex items-center justify-between shadow-lg">
                    <div>
                        <p class="text-slate-400 text-sm font-medium mb-1">${title}</p>
                        <h4 class="text-2xl font-bold text-white">${value}</h4>
                        <p class="text-xs text-[#41B6E6]/80 mt-1">${subtext}</p>
                    </div>
                    <div class="p-3 rounded-xl bg-gradient-to-br ${trendClass}">
                        <i data-lucide="${icon}" class="w-6 h-6"></i>
                    </div>
                </div>
            `;
        }

        // --- Main Logic ---
        let currentFilter = 'all';

        function renderStats() {
            const total = projects.length;
            const finalized = projects.filter(p => p.percentage === 100 || p.status === 'Finalized').length;
            
            // Calculate Average Progress
            // Filter out projects with null percentage to avoid NaN, though all currently have values
            const activeProjectsWithProgress = projects.filter(p => p.percentage !== null);
            const totalProgress = activeProjectsWithProgress.reduce((acc, curr) => acc + curr.percentage, 0);
            const averageProgress = activeProjectsWithProgress.length > 0 
                ? Math.round(totalProgress / activeProjectsWithProgress.length) 
                : 0;

            const grid = document.getElementById('stats-grid');
            grid.innerHTML = `
                ${createStatCard("Total Activities", total, "East Region", "layout-grid", "neutral")}
                ${createStatCard("Average Completion", `${averageProgress}%`, `Across ${total} Activities`, "trending-up", "up")}
                ${createStatCard("Ongoing Activities", total - finalized, "In Progress", "clock", "neutral")}
            `;
        }

        function renderCharts() {
            // Status Data: Breakdown into Ongoing, Finalized
            const finalized = projects.filter(p => p.status === 'Finalized' || p.percentage === 100).length;
            // Removed Stalled logic as requested
            const ongoing = projects.length - finalized;

            const statusData = [
                { value: ongoing, color: '#41B6E6' },   // Light Blue
                { value: finalized, color: '#006EB5' }  // Dark Blue
            ];
            
            // Render Status Chart & Legend
            const statusContainer = document.getElementById('status-chart-container');
            statusContainer.innerHTML = `
                ${createDonutChart(statusData)}
                <div class="space-y-3">
                    <div class="flex items-center gap-3 text-sm"><div class="w-3 h-3 rounded-full bg-[#41B6E6]"></div><span class="text-slate-400">Ongoing</span><span class="text-white font-bold">${ongoing}</span></div>
                    <div class="flex items-center gap-3 text-sm"><div class="w-3 h-3 rounded-full bg-[#006EB5]"></div><span class="text-slate-400">Finalized</span><span class="text-white font-bold">${finalized}</span></div>
                </div>
            `;

            // Donor Data
            const donors = {};
            projects.forEach(p => {
                const name = p.donor.trim(); 
                donors[name] = (donors[name] || 0) + 1;
            });

            const colors = ['#006EB5', '#41B6E6', '#008CBA', '#6699CC', '#89CFF0', '#004d80'];
            const donorData = Object.keys(donors).map((name, index) => ({
                name: name,
                value: donors[name],
                color: colors[index % colors.length]
            })).sort((a, b) => b.value - a.value);

            // Render Donor Chart - Updated to show unique donor count (4)
            document.getElementById('donor-chart-container').innerHTML = createDonutChart(donorData, 180, 16, donorData.length, "Donors");

            // Render Donor Legend
            document.getElementById('donor-legend').innerHTML = donorData.map(d => `
                <div class="flex items-center gap-4 group">
                    <div class="w-4 h-4 rounded-full shrink-0 shadow-[0_0_10px_rgba(0,0,0,0.3)]" style="background-color: ${d.color}"></div>
                    <div class="flex flex-col">
                        <span class="text-slate-400 text-sm font-medium group-hover:text-white transition-colors">${d.name}</span>
                        <div class="flex items-baseline gap-2">
                            <span class="text-2xl font-bold text-white">${d.value}</span>
                            <span class="text-xs text-slate-500 font-medium">Projects</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderProjects() {
            const grid = document.getElementById('projects-grid');
            const title = document.getElementById('projects-title');
            
            let filtered = projects;
            if (currentFilter === 'delayed') {
                filtered = projects.filter(p => {
                    const commentsLower = p.comments?.toLowerCase() || "";
                    const progressLower = p.progressDesc?.toLowerCase() || "";
                    return commentsLower.includes('delay') || 
                           commentsLower.includes('challenge') || 
                           commentsLower.includes('awaiting') ||
                           commentsLower.includes('stalled') ||
                           progressLower.includes('stalled') ||
                           commentsLower.includes("action required") ||
                           commentsLower.includes("follow up");
                });
                title.innerText = 'Activities Cards (Attention Required)';
            } else {
                title.innerText = 'Activities Cards';
            }

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full py-12 text-center text-slate-500 bg-[#002347]/30 rounded-2xl border border-dashed border-[#003366]">
                        <p>No projects match this filter.</p>
                    </div>`;
            } else {
                grid.innerHTML = filtered.map(p => createProjectCard(p)).join('');
            }
            
            // Refresh icons after inserting new HTML
            lucide.createIcons();
        }

        function setFilter(type) {
            currentFilter = type;
            
            // Update UI buttons
            const btnAll = document.getElementById('btn-all');
            const btnDelayed = document.getElementById('btn-delayed');
            const activeClass = "bg-[#006EB5] text-white shadow-lg shadow-[#006EB5]/20";
            const inactiveClass = "bg-[#002347] text-slate-400 border border-[#003366] hover:bg-[#003366]";

            if (type === 'all') {
                btnAll.className = `px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${activeClass}`;
                btnDelayed.className = `px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${inactiveClass}`;
            } else {
                btnAll.className = `px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${inactiveClass}`;
                btnDelayed.className = `px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${activeClass}`;
            }

            renderProjects();
        }

        function updateDate() {
            const dateElement = document.getElementById('last-updated-date');
            if (dateElement) {
                const now = new Date();
                const options = { day: 'numeric', month: 'short', year: 'numeric' };
                const formattedDate = now.toLocaleDateString('en-GB', options);
                dateElement.innerText = `Updated ${formattedDate}`;
            }
        }

        // --- Init ---
        window.onload = () => {
            updateDate();
            renderStats();
            renderCharts();
            renderProjects();
            lucide.createIcons();
        };

    </script>
</body>
</html>